# Roadmap & XBoard 对齐计划

ZNP 以 xboard 能力为基线，下表罗列当前阶段的重点工作与对应状态。

| 模块 | 里程碑 | 状态 |
| ---- | ------ | ---- |
| 节点管理 | 将节点/内核数据从内存迁移至数据库，支持同步记录 | ✅ 已完成 |
| 订阅模板 | 模板、发布历史存储在数据库并具备迁移/种子脚本 | ✅ 已完成 |
| 订阅管理 | 用户订阅改用数据库持久化，保留模板权限校验 | ✅ 已完成 |
| CLI 管理 | 提供统一命令行（serve/migrate/tools）驱动服务 | ✅ 已完成 |
| 数据库迁移 | 引入版本化迁移注册表与 CLI 目标版本控制 | ✅ 已完成 |
| gRPC 服务 | 集成 HTTP/gRPC 一体化进程，预留协议实现与健康检查 | 🔄 开发中 |
| 运维工具 | 引入定时任务、健康检查、日志轮转等工具 | ✅ 基础落地 |
| 套餐管理 | 引入 `plans` 表及管理 API，支撑多档套餐配置 | ✅ 已完成 |
| 公告中心 | 管理/用户双端公告模块、可见窗口与置顶能力 | ✅ 已完成 |
| 用户钱包 | 用户余额与流水查询、第三方安全校验 | ✅ 已完成 |
| 计费体系 | 对齐 xboard 套餐/订单模型，交付订单/余额扣费基础能力 | ✅ 已完成 |
| 多协议内核 | 完善内核注册、心跳与多协议分发能力 | 🔜 待设计 |
| 尚缺能力 | 注册/找回、管理员管理、支付网关接入、CORS、防刷、日志轮转、巡检/告警、API 文档 | 🔜 待补 |

> 说明：
> - ✅ 表示已在当前分支落地。
> - 🔄 表示正在设计或开发。
> - 🔜 表示排期在后续迭代。

欢迎通过 Issue 或 PR 参与上述特性的讨论与实现。

## 计费体系进展
- 订单与余额：支持套餐下单、余额扣费、订单取消/退款，订单条目与支付流水存储在数据库。
- 幂等与回调：订单创建支持 `idempotency_key`，支付回调幂等防降级；Webhook 可配置 IP/共享 token/Stripe 签名校验。
- 配置与观测：计费相关 CLI（migrate/serve）自带迁移与检查，暴露创建/支付/退款指标；支付回调与管理端操作带审计日志。
- 后续提升（欢迎贡献）：对接真实支付网关、优惠券/折扣、对账与开票、分账/多币种支持。

## 运维工具进展
- 基础工具：`znp tools check-config` 配置自检；`scripts/healthcheck.sh` 轻量探活与错误扫描；`scripts/backup-db.sh` MySQL/Postgres 导出；/metrics 暴露请求与业务指标。
- 部署模板：提供 systemd 单元与 Docker/Dockerfile（含 CGO 版）。
- 待补充：日志轮转示例、定时巡检/告警脚本、集成化备份/恢复流程。
